<!DOCTYPE html>
<html>
    <head>
        <title>midterm</title>
        <meta charset="utf-8">
        <meta name="description" content="midterm for Jamie's web 3 class">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" type="text/css" href="css/main.css"/>
    </head>
    <body>
        <input id="siteInput" type="text" contenteditable></input>
        <button id="btn" onclick="">go</button>
        <div id="main-container"></div>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="js/three.min.js"></script>
        <script src="js/tween.min.js"></script>
        <script src="js/TrackballControls.js"></script>
        <script src="js/CSS3DRenderer.js"></script>

    	<script type="text/javascript">
            var siteLink;
            //var contents;
            //loadPage('https://www.facebook.com/');
            var btn = document.getElementById('btn');

            btn.addEventListener('click',function(evt) {
                $('#main-container').html('');
                evt.preventDefault();
                evt.stopPropagation();
                siteLink = document.getElementById('siteInput').value;
                loadPage(siteLink);
            });

            // function loadPage(siteLink){
            //     $.getJSON('http://whateverorigin.org/get?url=' + encodeURIComponent(siteLink) + '&callback=?',
            //         function(data){
            //             //var divText = $(data.contents).find('div').text();
            //             //console.log(data.contents);
            //             var links = $(data.contents).filter('link');
            //             var divs = $(data.contents).find('div');
            //             for(var i = 0; i < divs.length; i++){
            //                 $(divs[i]).css({'float':'left'});
            //             }
            //             $('#main-container').html(links);
            //             console.log(links);
            //             $('#main-container').append(divs);
            //         }
            //     );
            // }   

            //--------------------three.js------------
            var camera, scene, renderer;
            var controls;
            var objects = [];
            var divs = [];
            var targets = { tdivs: [] };

            init();
            animate();

            function init() {
                camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 5000 );
                camera.position.z = 1500;

                scene = new THREE.Scene();
                var links;

                loadPage(siteLink);

                function loadPage(siteLink){
                    $.getJSON('http://whateverorigin.org/get?url=' + encodeURIComponent(siteLink) + '&callback=?',
                        function(data){
                            contents = data.contents;
                            links = $(data.contents).filter('link');
                            divs = $(data.contents).find('div');
                            $('#main-container').append(links);
                            for(var i = 0; i < divs.length; i++){
                                //divs[i].style({'float':'left'});
                                divs[i].className = 'module';
                                //$('#main-container').append(divs[i]);
                                var object = new THREE.CSS3DObject( divs[i] );
                                object.position.x = Math.random() * 6000 - 3000;
                                object.position.y = Math.random() * 6000 - 3000;
                                object.position.z = Math.random() * 2000 - 1000;
                                scene.add( object );

                                objects.push( object );

                                var object = new THREE.Object3D();
                                object.position.x =  Math.random() * 4000 - 2000;
                                object.position.y =  Math.random() * 2000 - 1000;

                                targets.tdivs.push( object );
                                transform( targets.tdivs, 5000 );
                            }
                            //console.log(links);
                        }
                    );
                }


                renderer = new THREE.CSS3DRenderer();
                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.domElement.style.position = 'absolute';
                document.getElementById( 'main-container' ).appendChild( renderer.domElement );

                //

                controls = new THREE.TrackballControls( camera, renderer.domElement );
                controls.rotateSpeed = 0.5;
                controls.addEventListener( 'change', render );



                //

                window.addEventListener( 'resize', onWindowResize, false );

            }

            function transform( targets, duration ) {

                TWEEN.removeAll();

                for ( var i = 0; i < objects.length; i ++ ) {

                    var object = objects[ i ];
                    var target = targets[ i ];

                    new TWEEN.Tween( object.position )
                        .to( { x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration )
                        .easing( TWEEN.Easing.Exponential.InOut )
                        .start();

                }

                new TWEEN.Tween( this )
                    .to( {}, duration * 2 )
                    .onUpdate( render )
                    .start();

            }

            function onWindowResize() {

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize( window.innerWidth, window.innerHeight );

                render();

            }

            function animate() {

                requestAnimationFrame( animate );

                TWEEN.update();
                controls.update();

            }

            function render() {

                renderer.render( scene, camera );

            }

    	</script>
        <script type="text/javascript" src="js/script.js"></script>
    </body>
</html>
		